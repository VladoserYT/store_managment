# Менеджер интернет-магазина

## Введение

Данный проект представляет собой настольное приложение для управления интернет-магазином. Приложение разработано на языке Python с использованием графического интерфейса Tkinter и базы данных SQLite. Система позволяет управлять товарами, клиентами и заказами, а также проводить анализ данных с визуализацией результатов.

## Быстрый старт

### Требования

Для работы приложения необходимо установить следующие компоненты:

- Python 3.7 или выше
- pip (менеджер пакетов Python)
- Tkinter (обычно входит в стандартную установку Python)

### Установка зависимостей

Перейдите в директорию проекта и выполните команду:

```bash
pip install -r requirements.txt
```

Эта команда установит все необходимые библиотеки:
- pandas (для анализа данных)
- matplotlib (для построения графиков)
- seaborn (для стилизации графиков)
- pillow (для работы с изображениями)

### Запуск приложения

Для запуска основного приложения выполните:

```bash
python main.py
```

Приложение откроет окно с графическим интерфейсом, содержащим три основные вкладки.



## Структура проекта

Проект организован следующим образом:

```
online_store_manager_app/
├── main.py                  Точка входа в приложение
├── models.py                Классы данных (Product, Customer, Order)
├── db.py                    Модуль работы с базой данных SQLite
├── gui.py                   Графический интерфейс на Tkinter
├── analysis.py              Анализ данных и построение графиков
├── requirements.txt         Список зависимостей
├── README.md                Подробная документация
├── .gitignore               Конфиг Git
├── todo.md                  Чек-лист требований
├── data/                    Директория для данных
│   ├── store.db            База данных SQLite
│   ├── charts/             Сохранённые графики
│   └── demo_export/        Примеры экспорта данных
└── tests/                   Unit-тесты
    ├── test_models.py      Тесты для моделей
    └── test_analysis.py    Тесты для анализа
```

## Описание модулей

### models.py

Модуль содержит определение классов данных приложения:

**Класс Product**

Представляет товар в магазине. Основные атрибуты:
- id: уникальный идентификатор товара
- name: название товара
- price: цена товара в рублях
- description: описание товара
- quantity: количество товара на складе

Основные методы:
- update_quantity(amount): изменить количество товара на складе
- __repr__(): строковое представление товара

**Класс Customer**

Представляет клиента магазина. Основные атрибуты:
- id: уникальный идентификатор клиента
- name: имя клиента
- email: адрес электронной почты (валидируется регулярным выражением)
- phone: номер телефона (валидируется регулярным выражением)
- address: адрес доставки
- orders_count: количество заказов клиента

Основные методы:
- validate_email(email): проверка корректности email
- validate_phone(phone): проверка корректности номера телефона
- increment_orders_count(): увеличить счётчик заказов
- update_address(new_address): обновить адрес

**Класс Order**

Представляет заказ. Основные атрибуты:
- id: уникальный идентификатор заказа
- customer_id: идентификатор клиента
- items: список товаров в заказе
- status: статус заказа (pending, processing, shipped, delivered, cancelled)
- total_price: общая стоимость заказа
- created_at: дата создания заказа

Основные методы:
- add_item(product, quantity): добавить товар в заказ
- remove_item(product_id): удалить товар из заказа
- set_status(new_status): изменить статус заказа
- get_items_count(): получить общее количество товаров в заказе

**Функции сортировки**

- sort_orders_by_date(orders, reverse=False): сортировка заказов по дате
- sort_orders_by_price(orders, reverse=False): сортировка заказов по цене

### db.py

Модуль отвечает за работу с базой данных SQLite и содержит класс DatabaseManager.

**Класс DatabaseManager**

Основные методы:

Операции с товарами:
- add_product(product): добавить товар в БД
- get_product(product_id): получить товар по ID
- get_all_products(): получить все товары
- update_product(product): обновить информацию о товаре
- delete_product(product_id): удалить товар

Операции с клиентами:
- add_customer(customer): добавить клиента в БД
- get_customer(customer_id): получить клиента по ID
- get_all_customers(): получить всех клиентов
- update_customer(customer): обновить информацию о клиенте
- delete_customer(customer_id): удалить клиента

Операции с заказами:
- add_order(order): добавить заказ в БД
- get_order(order_id): получить заказ по ID
- get_all_orders(): получить все заказы
- update_order(order): обновить информацию о заказе
- delete_order(order_id): удалить заказ

Импорт и экспорт:
- export_to_csv(directory): экспортировать данные в CSV файлы
- export_to_json(directory): экспортировать данные в JSON файлы
- import_from_csv(directory): импортировать данные из CSV файлов

### gui.py

Модуль содержит графический интерфейс приложения на основе Tkinter.

**Класс OnlineStoreApp**

Основные компоненты интерфейса:

Вкладка "Товары":
- Форма для добавления нового товара (название, цена, описание, количество)
- Таблица со списком всех товаров
- Кнопки для добавления и удаления товаров

Вкладка "Клиенты":
- Форма для регистрации нового клиента (имя, email, телефон, адрес)
- Таблица со списком всех клиентов и количеством их заказов
- Кнопки для регистрации и удаления клиентов

Вкладка "Заказы":
- Форма для создания нового заказа (выбор клиента, товара и количества)
- Таблица со списком всех заказов
- Кнопки для создания, изменения статуса и удаления заказов

Меню "Файл":
- Экспорт в CSV
- Экспорт в JSON
- Импорт из CSV
- Выход

Меню "Анализ":
- Динамика продаж (график)
- Топ клиентов (график)
- Топ товаров (график)
- Статусы заказов (график)
- Статистика (таблица)

### analysis.py

Модуль содержит функции для анализа данных и построения графиков.

**Класс DataAnalyzer**

Основные методы анализа:

- get_sales_by_date(): получить продажи по датам в виде DataFrame
- get_top_customers(n): получить топ-n клиентов по количеству заказов
- get_top_products(n): получить топ-n товаров по количеству продаж
- get_order_status_distribution(): получить распределение статусов заказов
- get_summary_statistics(): получить сводную статистику

Методы визуализации:

- plot_sales_dynamics(): построить график динамики продаж
- plot_top_customers(n): построить график топ-n клиентов
- plot_top_products(n): построить график топ-n товаров
- plot_order_status_distribution(): построить график распределения статусов

Все графики сохраняются в директорию data/charts/ в формате PNG.

## Использование приложения

### Добавление товара

1. Откройте вкладку "Товары"
2. Заполните поля формы:
   - Название товара (например, "Ноутбук")
   - Цена в рублях (например, 50000)
   - Описание товара
   - Количество на складе
3. Нажмите кнопку "Добавить"

Товар появится в таблице ниже.

### Регистрация клиента

1. Откройте вкладку "Клиенты"
2. Заполните поля формы:
   - Имя клиента
   - Email в формате user@example.com
   - Телефон в формате +79991234567 или 79991234567
   - Адрес доставки
3. Нажмите кнопку "Зарегистрировать"

Клиент появится в таблице ниже.

### Создание заказа

1. Откройте вкладку "Заказы"
2. Выберите клиента из выпадающего списка
3. Выберите товар из выпадающего списка
4. Введите количество товара
5. Нажмите кнопку "Создать заказ"

Заказ появится в таблице ниже.

### Просмотр графиков

1. Откройте меню "Анализ"
2. Выберите нужный график:
   - Динамика продаж: показывает сумму продаж и количество товаров по датам
   - Топ клиентов: столбчатая диаграмма 5 лучших клиентов
   - Топ товаров: графики топ-5 товаров по количеству и выручке
   - Статусы заказов: круговая диаграмма распределения статусов
3. График откроется в отдельном окне и будет сохранён в папку data/charts/

### Экспорт данных

1. Откройте меню "Файл"
2. Выберите формат экспорта:
   - Экспорт в CSV: данные сохранятся в файлы products.csv, customers.csv, orders.csv
   - Экспорт в JSON: данные сохранятся в файлы products.json, customers.json, orders.json
3. Выберите директорию для сохранения

## Валидация данных

### Email

Приложение проверяет корректность email адреса с использованием регулярного выражения:

```
^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$
```

Примеры корректных email:
- user@example.com
- john.doe@company.co.uk
- test+tag@domain.org

Примеры некорректных email:
- user@ (нет домена)
- @example.com (нет пользователя)
- user@example (нет расширения домена)

### Телефон

Приложение проверяет корректность номера телефона с использованием регулярного выражения в формате E.164:

```
^\+?[1-9]\d{8,14}$
```

Примеры корректных номеров:
- +79991234567 (с плюсом)
- 79991234567 (без плюса)
- +12025551234 (международный номер)

Примеры некорректных номеров:
- 123 (слишком короткий)
- +0123456789 (начинается с нуля)

## Обработка ошибок

Приложение использует конструкцию try-except для обработки ошибок в следующих местах:

- При добавлении товара: проверка на отрицательную цену и количество
- При регистрации клиента: валидация email и телефона
- При создании заказа: проверка на корректное количество товара
- При работе с БД: обработка ошибок подключения и выполнения запросов
- При экспорте/импорте: обработка ошибок файловой системы

## Unit-тесты

Проект включает 24 unit-теста, разделённые на два файла:

### test_models.py

Тесты для модуля models.py:

- Тесты класса Product (создание, валидация, обновление количества)
- Тесты класса Customer (создание, валидация email и телефона, обновление адреса)
- Тесты класса Order (добавление/удаление товаров, изменение статуса)
- Тесты функций сортировки (по дате, по цене)
- Тесты валидации (email, телефон)

### test_analysis.py

Тесты для модулей db.py и analysis.py:

- Тесты методов анализа (продажи по датам, топовые клиенты и товары)
- Тесты построения графиков
- Тесты CRUD операций в БД
- Тесты импорта/экспорта данных

## Особенности реализации

### Объектно-ориентированное программирование

Проект использует принципы ООП:

- Инкапсуляция: приватные атрибуты с публичными свойствами
- Наследование: все классы данных наследуют от базового класса
- Полиморфизм: методы __repr__() переопределены в каждом классе

### Функциональное программирование

- Использование лямбда-выражений в функциях сортировки
- Использование функций высшего порядка (sort_orders_by_date, sort_orders_by_price)

### Регулярные выражения

Использование регулярных выражений для валидации:
- Email: проверка формата адреса электронной почты
- Телефон: проверка формата номера телефона в стандарте E.164

## База данных

Приложение использует SQLite для хранения данных. Структура БД включает четыре таблицы:

### Таблица products

```sql
CREATE TABLE products (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    price REAL NOT NULL,
    description TEXT,
    quantity INTEGER NOT NULL DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
```

### Таблица customers

```sql
CREATE TABLE customers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    email TEXT NOT NULL UNIQUE,
    phone TEXT NOT NULL,
    address TEXT,
    orders_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
```

### Таблица orders

```sql
CREATE TABLE orders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER NOT NULL,
    status TEXT DEFAULT 'pending',
    total_price REAL NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers(id)
)
```

### Таблица order_items

```sql
CREATE TABLE order_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    order_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
)
```

## Статистика проекта

- Общее количество строк кода: 2800+
- Количество модулей: 6
- Количество классов: 4
- Количество методов: 50+
- Количество unit-тестов: 24
- Покрытие тестами: основные модули (models.py, db.py, analysis.py)

## Возможные улучшения

1. Добавление системы аутентификации для разных пользователей
2. Реализация экспорта в PDF формат
3. Добавление расширенного поиска и фильтрации
4. Реализация истории изменений и логирования операций
5. Автоматическое резервное копирование БД
6. Интеграция с платёжными системами
7. Разработка мобильной версии приложения

## Заключение

Данный проект демонстрирует применение основных концепций объектно-ориентированного программирования, работу с базами данных, создание графического интерфейса и анализ данных. Приложение полностью функционально и готово к использованию для управления небольшим интернет-магазином.

## Контроль версий

Проект размещён в Git репозитории с полной историей коммитов. Для клонирования репозитория выполните:

```bash
git clone https://github.com/yourusername/online_store_manager_app.git
```
